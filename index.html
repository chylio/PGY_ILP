<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººåŒ–å­¸ç¿’è¨ˆç•« (ILP) å¹³å°</title>
    <!-- Chosen Palette: Professional & Clean (Blue, Grays, White) -->
    <!-- Application Structure Plan: A single-page application (SPA) with a new login-first architecture. The initial view is a login form. Upon successful "login," the view switches to the student's main dashboard, which serves as the central hub. From the dashboard, the user can navigate to other "pages" like the ILP form or analysis reports. This is managed by dynamically showing/hiding different content sections (divs) instead of reloading the page, creating a seamless multi-page experience within a single HTML file. This structure directly implements the user flow shown in the provided images. -->
    <!-- Visualization & Content Choices: 
        - Login Form (Goal: Authentication): A standard, clean form as per the user's image.
        - Student Dashboard (Goal: Overview/Navigation): Uses stat cards for key metrics and a list of existing ILPs. A prominent "New Plan" button serves as the primary call-to-action. This replaces the old role-selection screen with a more functional, data-driven entry point.
        - ILP Form (Goal: Data Entry): A clean, single-column form within a card, matching the user's provided design for a professional and focused data entry experience.
        - Teacher Dashboard (Goal: Review/Manage): Implements the user-provided design with stat cards and an interactive student list for efficient management.
        - Admin Dashboard (Goal: Monitor/Manage): Implements the user-provided design with high-level stat cards, a recent activity feed, and quick action buttons for system-wide management.
        - All interactions are handled with vanilla JavaScript to update the DOM dynamically. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
        }
        .view { display: none; }
        .view.active { display: block; }
        .form-label { @apply block text-gray-700 text-sm font-medium mb-2; }
        .form-input, .form-textarea, .form-select { @apply bg-white border border-gray-300 rounded-md w-full py-2.5 px-3 text-gray-800 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200; }
        .form-textarea { @apply h-32 resize-none; }
        .btn { @apply font-semibold py-2 px-5 rounded-lg focus:outline-none focus:shadow-outline transition-all duration-300; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white; }
        .btn-secondary { @apply bg-gray-200 hover:bg-gray-300 text-gray-700; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 md:p-8">

        <!-- ===== Login View ===== -->
        <div id="login-view" class="view active">
            <div class="max-w-md mx-auto mt-10">
                <header class="mb-8 text-center">
                    <h1 class="text-3xl font-bold text-blue-600">ILP å­¸ç¿’å¹³å°</h1>
                    <p class="text-gray-500 mt-2">å€‹äººåŒ–å­¸ç¿’è¨ˆç•«ç®¡ç†ç³»çµ±</p>
                </header>
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label for="identity" class="form-label">èº«ä»½</label>
                            <select id="identity" name="identity" class="form-select">
                                <option value="student1">å­¸ç”Ÿ</option>
                                <option value="teacher1">æ•™å¸«</option>
                                <option value="admin1">ç®¡ç†è€…</option>
                            </select>
                        </div>
                        <div>
                            <label for="password" class="form-label">å¯†ç¢¼</label>
                            <input type="password" id="password" name="password" class="form-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" value="password">
                        </div>
                        <button type="submit" class="btn btn-primary w-full !py-3">ç™»å…¥</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ===== Main Application View (For Logged-in Users) ===== -->
        <div id="main-app-view" class="view max-w-7xl mx-auto">
            <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                <div class="flex items-center gap-6">
                    <h1 class="text-2xl font-bold text-blue-600">ILP å­¸ç¿’å¹³å°</h1>
                    <nav id="main-nav" class="flex gap-4">
                        <!-- Nav links will be injected here -->
                    </nav>
                </div>
                <div class="flex items-center gap-4">
                    <span id="welcome-message" class="text-gray-600"></span>
                    <button id="logout-btn" class="btn btn-secondary">ç™»å‡º</button>
                </div>
            </header>
            <main id="app-content">
                <!-- Content for each role's pages will be injected here -->
            </main>
        </div>

    </div>
    
    <div id="error-box" class="hidden fixed top-5 right-5 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg" role="alert">
      <strong class="font-bold">ç™¼ç”ŸéŒ¯èª¤ï¼</strong>
      <span id="error-message" class="block sm:inline"></span>
    </div>

    <!-- Templates for dynamic content will go here -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ===== DATA (Mock Database) =====
            const MOCK_DATA = {
                users: {
                    student1: { role: 'student', name: 'ç‹å°æ˜' },
                    teacher1: { role: 'teacher', name: 'é™³è€å¸«' },
                    admin1: { role: 'admin', name: 'ç³»çµ±ç®¡ç†å“¡' },
                },
                ilpQuestionsCSV: `field_key,label,type,options,required,placeholder,helper_text
name,å§“å,text,,True,ç‹å°æ˜,,
gender,æ€§åˆ¥,select,"ç”·;å¥³;å…¶ä»–",True,,
rank,è·ç´š/ç­ç´š,text,,True,PGY-1,,
fill_date,å¡«å¯«æ—¥æœŸ,date,,True,,
goal,å­¸ç¿’ç›®æ¨™ä¸€,textarea,,True,è«‹æè¿°æ‚¨çš„å­¸ç¿’ç›®æ¨™...,(ä½ æƒ³å­¸ä»€éº¼ï¼Ÿ)
motivation,å­¸ç¿’å‹•æ©Ÿ,textarea,,True,è«‹æè¿°æ‚¨çš„å­¸ç¿’å‹•æ©Ÿ...,(ä»€éº¼äº‹ä»¶èª˜ç™¼ä½ æƒ³è¦å­¸é€™å€‹ï¼Ÿ)
strategy,å­¸ç¿’ç­–ç•¥,textarea,,False,è«‹æè¿°æ‚¨çš„å­¸ç¿’ç­–ç•¥...,(ä½ éœ€è¦åšä»€éº¼ï¼Ÿ)
resources,å­¸ç¿’è³‡æº,textarea,,False,è«‹æè¿°æ‰€éœ€çš„è³‡æº...,(éœ€è¦èª°çš„å¹«å¿™æˆ–ä»€éº¼è¨­å‚™ï¼Ÿ)
challenges,å¯èƒ½é­é‡çš„å›°é›£,textarea,,False,è«‹é æƒ³å¯èƒ½é‡åˆ°çš„å›°é›£...,
assessment,è©•ä¼°å…§å®¹èˆ‡æŒ‡æ¨™,textarea,,True,è«‹æè¿°è©•ä¼°æ–¹å¼å’ŒæˆåŠŸæŒ‡æ¨™...,(æ€éº¼æ¨£æ‰èƒ½è­‰æ˜ä½ é”åˆ°ä½ çš„å­¸ç¿’ç›®æ¨™ï¼Ÿ)
timeline,é è¨ˆæ™‚ç¨‹,text,,True,"ä¾‹å¦‚ï¼š3å€‹æœˆã€åŠå¹´...",(é€™éƒ¨åˆ†çš„å­¸ç¿’é è¨ˆå¤šä¹…é”æˆï¼Ÿ)`,
                studentDashboard: {
                    plans: 1,
                    completionRate: '0%',
                    aiAnalysis: 0,
                    ilps: [
                        { id: 1, title: 'æå‡å€¼ç­è™•ç†ç·Šæ€¥ç‹€æ³çš„èƒ½åŠ›', status: 'è‰ç¨¿', date: '2025/8/9' }
                    ]
                },
                teacherDashboard: {
                    totalStudents: 4,
                    ongoingPlans: 8,
                    completedPlans: 2,
                    pendingReview: 3,
                    students: [
                        { name: 'ç‹å°æ˜', class: 'ä¸‰å¹´ä¸€ç­', planCount: 3, lastActivity: '2024/1/15' },
                        { name: 'æå°è¯', class: 'ä¸‰å¹´ä¸€ç­', planCount: 2, lastActivity: '2024/1/14' },
                        { name: 'å¼µå°ç¾', class: 'ä¸‰å¹´äºŒç­', planCount: 4, lastActivity: '2024/1/16' },
                        { name: 'é™³å°å¼·', class: 'ä¸‰å¹´äºŒç­', planCount: 1, lastActivity: '2024/1/13' },
                    ]
                },
                adminDashboard: {
                    totalUsers: 156,
                    studentCount: 142,
                    teacherCount: 12,
                    totalPlans: 284,
                    activeUsers: 89,
                    systemStatus: 'æ­£å¸¸',
                    recentActivities: [
                        { icon: 'â¡ï¸', text: 'å­¸ç”Ÿç™»å…¥ç³»çµ±', user: 'ç‹å°æ˜', time: '2024-01-16 14:30' },
                        { icon: 'ğŸ“', text: 'å»ºç«‹æ–°å­¸ç¿’è¨ˆç•«', user: 'æå°è¯', time: '2024-01-16 14:25' },
                        { icon: 'ğŸ’¡', text: 'å®Œæˆè¨ˆç•«åˆ†æ', user: 'AIç³»çµ±', time: '2024-01-16 14:20' },
                        { icon: 'â¡ï¸', text: 'æ•™å¸«ç™»å…¥ç³»çµ±', user: 'é™³è€å¸«', time: '2024-01-16 14:15' },
                        { icon: 'ğŸ”„', text: 'æ›´æ–°å­¸ç¿’è¨ˆç•«', user: 'å¼µå°ç¾', time: '2024-01-16 14:10' },
                    ]
                }
            };

            // ===== STATE MANAGEMENT =====
            let appState = {
                currentUser: null,
                currentView: 'login',
            };

            // ===== DOM ELEMENTS =====
            const loginView = document.getElementById('login-view');
            const mainAppView = document.getElementById('main-app-view');
            const appContent = document.getElementById('app-content');
            const mainNav = document.getElementById('main-nav');
            const welcomeMessage = document.getElementById('welcome-message');

            // ===== UTILITY FUNCTIONS =====
            function showError(message) {
                const errorBox = document.getElementById('error-box');
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = message;
                errorBox.classList.remove('hidden');
                setTimeout(() => errorBox.classList.add('hidden'), 5000);
            }
            
            function parseCSV(csvText) {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                return lines.slice(1).map(line => {
                    const values = line.match(/(".*?"|[^",\r\n]+)(?=\s*,|\s*$)/g).map(v => v.replace(/"/g, ''));
                    return headers.reduce((obj, header, index) => {
                        obj[header.trim()] = values[index] ? values[index].trim() : '';
                        return obj;
                    }, {});
                });
            }

            // ===== VIEW SWITCHING & RENDERING =====
            function navigateTo(view, data = null) {
                appState.currentView = view;
                appContent.innerHTML = '';
                updateNav();

                switch (view) {
                    case 'student-dashboard': renderStudentDashboard(); break;
                    case 'student-form': renderStudentForm(data); break;
                    case 'teacher-dashboard': renderTeacherDashboard(); break;
                    case 'admin-dashboard': renderAdminDashboard(); break;
                }
            }
            
            function updateNav() {
                mainNav.innerHTML = '';
                let navItems = [];

                if (!appState.currentUser) return;

                switch (appState.currentUser.role) {
                    case 'student':
                        navItems = [
                            { name: 'æˆ‘çš„è¨ˆç•«', view: 'student-dashboard' },
                            { name: 'åˆ†æå ±å‘Š', view: 'student-report' }
                        ];
                        break;
                    case 'teacher':
                        navItems = [
                            { name: 'å­¸ç”Ÿç®¡ç†', view: 'teacher-dashboard' },
                            { name: 'åˆ†æçµ±è¨ˆ', view: 'teacher-analytics' }
                        ];
                        break;
                    case 'admin':
                        navItems = [
                            { name: 'ç³»çµ±ç¸½è¦½', view: 'admin-dashboard' },
                            { name: 'ç”¨æˆ¶ç®¡ç†', view: 'admin-users' }
                        ];
                        break;
                }

                navItems.forEach(item => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = item.name;
                    link.className = `px-3 py-2 rounded-md text-sm font-medium transition-colors ${appState.currentView === item.view ? 'bg-blue-100 text-blue-700' : 'text-gray-500 hover:bg-gray-100'}`;
                    link.onclick = (e) => { e.preventDefault(); navigateTo(item.view); };
                    mainNav.appendChild(link);
                });
            }

            function renderStudentDashboard() {
                const data = MOCK_DATA.studentDashboard;
                appContent.innerHTML = `
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">æ­¡è¿å›ä¾†ï¼Œ${appState.currentUser.name}</h2>
                        <p class="text-gray-500">ç®¡ç†æ‚¨çš„å€‹äººåŒ–å­¸ç¿’è¨ˆç•«</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow flex items-center gap-4">
                            <div class="bg-blue-100 p-3 rounded-lg"><span class="text-2xl">ğŸ“˜</span></div>
                            <div><p class="text-gray-500">å­¸ç¿’è¨ˆç•«</p><p class="text-2xl font-bold">${data.plans}</p><p class="text-sm text-gray-400">å·²å»ºç«‹è¨ˆç•«</p></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow flex items-center gap-4">
                            <div class="bg-green-100 p-3 rounded-lg"><span class="text-2xl">ğŸ“ˆ</span></div>
                            <div><p class="text-gray-500">å®Œæˆç‡</p><p class="text-2xl font-bold">${data.completionRate}</p><p class="text-sm text-gray-400">è¨ˆç•«é”æˆç‡</p></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow flex items-center gap-4">
                            <div class="bg-yellow-100 p-3 rounded-lg"><span class="text-2xl">ğŸ’¡</span></div>
                            <div><p class="text-gray-500">AI åˆ†æ</p><p class="text-2xl font-bold">${data.aiAnalysis}</p><p class="text-sm text-gray-400">å·²åˆ†æè¨ˆç•«</p></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">æˆ‘çš„å­¸ç¿’è¨ˆç•«</h3>
                        <button id="add-new-plan-btn" class="btn btn-primary flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            æ–°å¢è¨ˆç•«
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <ul id="ilp-list">${data.ilps.map(ilp => `<li class="p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 cursor-pointer" data-ilp-id="${ilp.id}"><div class="flex justify-between items-center"><p class="font-semibold">${ilp.title}</p><span class="text-xs font-medium px-2 py-1 rounded-full bg-yellow-200 text-yellow-800">${ilp.status}</span></div><p class="text-sm text-gray-500 mt-1">å»ºç«‹æ—¥æœŸï¼š${ilp.date}</p></li>`).join('')}</ul>
                    </div>`;
                document.getElementById('add-new-plan-btn').addEventListener('click', () => navigateTo('student-form'));
            }
            
            function renderStudentForm(data) {
                const questions = parseCSV(MOCK_DATA.ilpQuestionsCSV);
                appContent.innerHTML = `<div class="max-w-4xl mx-auto"><button id="back-to-dashboard-btn" class="btn btn-secondary mb-6 flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>è¿”å›</button><div class="bg-white p-8 rounded-xl shadow-lg"><h2 class="text-2xl font-bold mb-6 border-b pb-4">å€‹äººåŒ–å­¸ç¿’è¨ˆç•«è¡¨å–® (ILP)</h2><form id="ilp-form" class="space-y-6"></form></div></div>`;
                const ilpForm = appContent.querySelector('#ilp-form');
                const basicInfoContainer = document.createElement('div');
                basicInfoContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-6';
                questions.forEach(q => {
                    const fieldWrapper = document.createElement('div');
                    if (['name', 'gender', 'rank', 'fill_date'].includes(q.field_key)) { basicInfoContainer.appendChild(fieldWrapper); } else { ilpForm.appendChild(fieldWrapper); }
                    const label = document.createElement('label');
                    label.className = 'form-label';
                    label.setAttribute('for', q.field_key);
                    label.textContent = q.label;
                    if(q.helper_text) { label.textContent += ` ${q.helper_text}`; }
                    fieldWrapper.appendChild(label);
                    let inputElement;
                    switch (q.type) {
                        case 'select': inputElement = document.createElement('select'); inputElement.className = 'form-select'; q.options.split(';').forEach(opt => { const optionElement = document.createElement('option'); optionElement.value = opt; optionElement.textContent = opt; inputElement.appendChild(optionElement); }); break;
                        case 'textarea': inputElement = document.createElement('textarea'); inputElement.className = 'form-textarea'; break;
                        case 'date': inputElement = document.createElement('input'); inputElement.type = 'date'; inputElement.className = 'form-input'; inputElement.valueAsDate = new Date(); break;
                        default: inputElement = document.createElement('input'); inputElement.type = 'text'; inputElement.className = 'form-input'; break;
                    }
                    inputElement.id = q.field_key; inputElement.name = q.field_key;
                    if (q.placeholder) inputElement.placeholder = q.placeholder;
                    if (q.required === 'True') inputElement.required = true;
                    fieldWrapper.appendChild(inputElement);
                });
                ilpForm.prepend(basicInfoContainer);
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'flex justify-end gap-4 pt-6 border-t';
                buttonContainer.innerHTML = `<button type="button" class="btn btn-secondary">å–æ¶ˆ</button><button type="submit" class="btn btn-primary">æäº¤è¨ˆç•«</button>`;
                ilpForm.appendChild(buttonContainer);
                document.getElementById('back-to-dashboard-btn').addEventListener('click', () => navigateTo('student-dashboard'));
            }

            function renderTeacherDashboard() {
                const data = MOCK_DATA.teacherDashboard;
                appContent.innerHTML = `
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">æ•™å¸«å„€è¡¨æ¿</h2>
                        <p class="text-gray-500">ç®¡ç†å­¸ç”Ÿçš„å€‹äººåŒ–å­¸ç¿’è¨ˆç•«</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow"><p class="text-gray-500">å­¸ç”Ÿç¸½æ•¸</p><p class="text-3xl font-bold text-blue-600 mt-2">${data.totalStudents}</p></div>
                        <div class="bg-white p-6 rounded-xl shadow"><p class="text-gray-500">é€²è¡Œä¸­è¨ˆç•«</p><p class="text-3xl font-bold text-yellow-500 mt-2">${data.ongoingPlans}</p></div>
                        <div class="bg-white p-6 rounded-xl shadow"><p class="text-gray-500">å·²å®Œæˆè¨ˆç•«</p><p class="text-3xl font-bold text-green-500 mt-2">${data.completedPlans}</p></div>
                        <div class="bg-white p-6 rounded-xl shadow"><p class="text-gray-500">å¾…å¯©æ ¸</p><p class="text-3xl font-bold text-red-500 mt-2">${data.pendingReview}</p></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">å­¸ç”Ÿåˆ—è¡¨</h3><select class="form-select w-48"><option>æ‰€æœ‰ç­ç´š</option></select></div>
                        <table class="w-full text-left">
                            <thead><tr class="border-b text-gray-500 text-sm"><th class="py-3 px-4 font-medium">å­¸ç”Ÿå§“å</th><th class="py-3 px-4 font-medium">ç­ç´š</th><th class="py-3 px-4 font-medium">è¨ˆç•«æ•¸é‡</th><th class="py-3 px-4 font-medium">æœ€å¾Œæ´»å‹•</th><th class="py-3 px-4 font-medium">æ“ä½œ</th></tr></thead>
                            <tbody>${data.students.map(s => `<tr class="border-b last:border-b-0"><td class="py-3 px-4">${s.name}</td><td class="py-3 px-4">${s.class}</td><td class="py-3 px-4">${s.planCount}</td><td class="py-3 px-4">${s.lastActivity}</td><td class="py-3 px-4 text-blue-600 space-x-4"><a href="#" class="font-semibold hover:underline">æŸ¥çœ‹è¨ˆç•«</a><a href="#" class="font-semibold hover:underline">ç™¼é€è¨Šæ¯</a></td></tr>`).join('')}</tbody>
                        </table>
                    </div>`;
            }

            function renderAdminDashboard() {
                const data = MOCK_DATA.adminDashboard;
                appContent.innerHTML = `
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8">
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">ç¸½ç”¨æˆ¶æ•¸</p><p class="text-3xl font-bold text-blue-600 mt-2">${data.totalUsers}</p></div>
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">å­¸ç”Ÿæ•¸é‡</p><p class="text-3xl font-bold text-green-600 mt-2">${data.studentCount}</p></div>
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">æ•™å¸«æ•¸é‡</p><p class="text-3xl font-bold text-yellow-600 mt-2">${data.teacherCount}</p></div>
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">å­¸ç¿’è¨ˆç•«</p><p class="text-3xl font-bold text-purple-600 mt-2">${data.totalPlans}</p></div>
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">æ´»èºç”¨æˆ¶</p><p class="text-3xl font-bold text-teal-500 mt-2">${data.activeUsers}</p></div>
                        <div class="bg-white p-5 rounded-xl shadow text-center"><p class="text-sm text-gray-500">ç³»çµ±ç‹€æ…‹</p><p class="text-3xl font-bold text-green-500 mt-2">${data.systemStatus}</p></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow">
                            <h3 class="text-xl font-bold mb-4">æœ€è¿‘æ´»å‹•</h3>
                            <ul class="space-y-4">${data.recentActivities.map(act => `
                                <li class="flex items-start gap-4">
                                    <span class="text-xl pt-1">${act.icon}</span>
                                    <div>
                                        <p class="font-semibold">${act.text} <span class="text-gray-600 font-normal">- ${act.user}</span></p>
                                        <p class="text-sm text-gray-400">${act.time}</p>
                                    </div>
                                </li>`).join('')}
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow">
                            <h3 class="text-xl font-bold mb-4">å¿«é€Ÿæ“ä½œ</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button class="bg-blue-50 text-blue-700 p-4 rounded-lg text-center hover:bg-blue-100 transition-colors"><div class="text-2xl mb-1">ğŸ‘¤</div><span class="font-semibold text-sm">æ–°å¢ç”¨æˆ¶</span></button>
                                <button class="bg-green-50 text-green-700 p-4 rounded-lg text-center hover:bg-green-100 transition-colors"><div class="text-2xl mb-1">âš™ï¸</div><span class="font-semibold text-sm">ç³»çµ±è¨­å®š</span></button>
                                <button class="bg-yellow-50 text-yellow-700 p-4 rounded-lg text-center hover:bg-yellow-100 transition-colors"><div class="text-2xl mb-1">ğŸ“¤</div><span class="font-semibold text-sm">åŒ¯å‡ºè³‡æ–™</span></button>
                                <button class="bg-red-50 text-red-700 p-4 rounded-lg text-center hover:bg-red-100 transition-colors"><div class="text-2xl mb-1">ğŸ“ˆ</div><span class="font-semibold text-sm">åˆ†æå ±å‘Š</span></button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ===== EVENT HANDLERS =====
            function handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('identity').value;
                const user = MOCK_DATA.users[username];

                if (user) {
                    appState.currentUser = user;
                    loginView.classList.remove('active');
                    mainAppView.classList.add('active');
                    welcomeMessage.textContent = `æ­¡è¿ï¼Œ${user.name}`;
                    
                    switch(user.role) {
                        case 'student': navigateTo('student-dashboard'); break;
                        case 'teacher': navigateTo('teacher-dashboard'); break;
                        case 'admin': navigateTo('admin-dashboard'); break;
                    }
                } else {
                    showError('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
                }
            }

            function handleLogout() {
                appState.currentUser = null;
                mainAppView.classList.remove('active');
                loginView.classList.add('active');
            }

            // ===== INITIALIZATION & EVENT LISTENERS =====
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
        });
    </script>
</body>
</html>
